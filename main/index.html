<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hong Kong Live Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #121212; color: #e0e0e0; line-height: 1.6; 
        }
        .header { 
            background: linear-gradient(135deg, #1e3c72, #2a5298); 
            padding: 1rem; text-align: center; 
        }
        
        /* ğŸ”¥ æ–°ç‰ˆé¢ï¼šå·¦20%å¤©æ°£ + å³80%æ–°è */
        .hero-section {
            display: grid; 
            grid-template-columns: 1fr 4fr; /* 20% : 80% */
            gap: 1.5rem; 
            max-width: 1400px; margin: 2rem auto; padding: 0 1rem; 
        }
        
        .weather-hero {
            background: linear-gradient(135deg, #0d47a1, #1976d2); 
            border-radius: 20px; padding: 2rem; 
            box-shadow: 0 8px 32px rgba(13,71,161,0.4);
            height: 280px; display: flex; flex-direction: column; justify-content: center;
        }
        
        .news-hero {
            background: #1e1e1e; border-radius: 20px; padding: 2rem; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.4); overflow-y: auto; max-height: 280px;
        }
        
        .hero-title { color: #ffffff; font-size: 1.4rem; font-weight: bold; margin-bottom: 1rem; }
        .weather-temp { font-size: 3.5rem; font-weight: 300; color: #ffffff; margin-bottom: 0.5rem; }
        .weather-desc { font-size: 1.3rem; color: #e3f2fd; margin-bottom: 1rem; }
        .weather-details { font-size: 0.95rem; color: #bbdefb; }
        
        .news-item { 
            padding: 1rem 0; border-bottom: 1px solid #333; cursor: pointer; 
            transition: all 0.3s; display: flex; 
        }
        .news-item:hover { background: #2a2a2a; border-radius: 12px; padding-left: 1rem; transform: translateX(5px); }
        .news-title { color: #ffffff; font-weight: 600; font-size: 1.1rem; flex: 1; }
        .news-source { color: #4fc3f7; font-size: 0.9rem; font-weight: 500; min-width: 100px; }
        .news-time { color: #888; font-size: 0.8rem; margin-left: auto; }
        
        /* ä¸‹é¢å°å¡ */
        .dashboard { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 1.5rem; max-width: 1200px; margin: 2rem auto; padding: 0 1rem; 
        }
        .card { background: #1e1e1e; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .card h3 { color: #4fc3f7; margin-bottom: 1rem; }
        
        .widget { 
            position: fixed; top: 20px; right: 20px; background: #0d47a1; 
            color: white; padding: 1rem; border-radius: 12px; min-width: 220px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.5); z-index: 1000; 
        }
        @media (max-width: 1024px) { 
            .hero-section { grid-template-columns: 1fr; } 
            .dashboard { grid-template-columns: 1fr; } 
            .widget { position: static; margin: 1rem; } 
        }
    </style>
</head>
<body>
    <div class="widget" id="liveWidget">
        <div><strong>Hong Kong Time:</strong> <span id="hkTime"></span></div>
        <div><strong>News:</strong> <span id="rssStatus">Loading...</span></div>
        <div><strong>Last Update:</strong> <span id="lastUpdate"></span></div>
    </div>

    <header class="header">
        <h1>ğŸ‡­ğŸ‡° Hong Kong Live Dashboard</h1>
        <p>Instant weather + breaking news + live updates</p>
    </header>

    <!-- ğŸ”¥ å·¦ä¸Šè§’å¤§å¤©æ°£ + å¤§æ–°è -->
    <section class="hero-section">
        <div class="weather-hero">
            <div class="hero-title">ğŸŒ¤ï¸ Live Weather</div>
            <div class="weather-temp" id="weatherTemp">--Â°C</div>
            <div class="weather-desc" id="weatherDesc">Loading...</div>
            <div class="weather-details" id="weatherDetails">King's Park Observatory</div>
        </div>
        
        <div class="news-hero">
            <div class="hero-title">ğŸ“° Breaking News <span class="status" id="newsCount"></span></div>
            <div id="heroNews">Loading latest headlines...</div>
        </div>
    </section>

    <!-- ä¸‹é¢å°åŠŸèƒ½å¡ -->
    <main class="dashboard">
        <section class="card">
            <h3>ğŸ›£ï¸ Live Traffic</h3>
            <div id="traffic"><a href="https://www.td.gov.hk/en/traffic_notices/index_id_12052.html" target="_blank">Transport Dept Live Map</a></div>
        </section>
        
        <section class="card">
            <h3>ğŸ¥ A&E Waiting</h3>
            <div id="aewait"><a href="https://www.ha.org.hk/visitor/ha_visitor_index.asp?Content_ID=235504&Lang=ENG" target="_blank">Hospital Authority Live Status</a></div>
        </section>
        
        <section class="card">
            <h3>ğŸ“Š Immigration</h3>
            <div>Today / 7-day avg checkpoint data (coming soon)</div>
        </section>
    </main>

    <script>
        // RSS feedsï¼ˆç©©å®šç‰ˆï¼‰
        const RSS_FEEDS = [
            { url: 'https://feeds.hongkongherald.com/rss/b82693edf38ebff8', name: 'HK Herald' },
            { url: 'https://www.hongkongfp.com/feed/', name: 'HKFP' },
            { url: 'https://rthk.hk/rthk/news/rss/c_expressnews_clocal.xml', name: 'RTHK' }
        ];

        // ğŸ”¥ å¤§å¤©æ°£ï¼ˆè¶…é†’ç›®ï¼‰
        async function fetchHeroWeather() {
            try {
                const res = await fetch('https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=rhrread&lang=en');
                const data = await res.json();
                const temp = data.temperature.data[0]?.value || '--';
                const desc = data.weatherDesc[0] || 'N/A';
                const place = data.temperature.data[0]?.place || 'Hong Kong';
                
                document.getElementById('weatherTemp').textContent = `${temp}Â°C`;
                document.getElementById('weatherDesc').textContent = desc;
                document.getElementById('weatherDetails').textContent = `${place} â€¢ Updated now`;
            } catch(e) {
                document.getElementById('weatherTemp').textContent = '--Â°C';
                document.getElementById('weatherDesc').textContent = 'Weather unavailable';
            }
        }

        // ğŸ”¥ å¤§æ–°èï¼ˆ8æˆç©ºé–“ï¼Œé¡¯ç¤º12æ¢ï¼‰
        async function fetchHeroNews() {
            const newsDiv = document.getElementById('heroNews');
            const statusSpan = document.getElementById('rssStatus');
            newsDiv.innerHTML = '<div style="color:#888;padding:2rem;">ğŸ“° Loading breaking news...</div>';

            try {
                const results = await Promise.allSettled(RSS_FEEDS.map(f => fetchRSS(f)));
                let allItems = [];
                
                results.forEach((r, i) => {
                    if (r.status === 'fulfilled' && r.value.length) {
                        allItems.push(...r.value);
                        statusSpan.textContent += `âœ“${RSS_FEEDS[i].name} `;
                    }
                });

                allItems.sort((a, b) => b.pubDate - a.pubDate);
                const unique = allItems.slice(0, 12).filter((item, i, arr) => 
                    arr.findIndex(t => t.link === item.link) === i
                );

                let html = '';
                unique.forEach(item => {
                    html += `
                        <div class="news-item" onclick="window.open('${item.link}', '_blank')">
                            <div class="news-title">${item.title}</div>
                            <div class="news-source">${item.source}</div>
                            <div class="news-time">${item.pubDate.toLocaleDateString('zh-HK')}</div>
                        </div>
                    `;
                });
                
                newsDiv.innerHTML = html || '<div style="color:#ff6b6b;">No news available</div>';
                document.getElementById('newsCount').textContent = `(${unique.length})`;
                statusSpan.textContent = `${unique.length} news âœ“`;
                
            } catch(e) {
                newsDiv.innerHTML = '<div style="color:#ff6b6b;">News loading failed</div>';
            }
        }

        async function fetchRSS(feed) {
            const res = await fetch(feed.url);
            const text = await res.text();
            const xml = new DOMParser().parseFromString(text, "text/xml");
            return Array.from(xml.querySelectorAll("item")).slice(0, 4).map(item => ({
                title: (item.querySelector("title")?.textContent || '').replace(/<!\[CDATA\[(.*?)\]\]>/gs, '$1').trim(),
                link: item.querySelector("link")?.textContent?.trim() || '#',
                pubDate: new Date(item.querySelector("pubDate")?.textContent || Date.now()),
                source: feed.name
            })).filter(i => i.title && i.link !== '#');
        }

        // Widgetæ™‚é–“
        function updateTime() {
            const now = new Date().toLocaleString('en-GB', { timeZone: 'Asia/Hong_Kong' });
            document.getElementById('hkTime').textContent = now;
            document.getElementById('lastUpdate').textContent = now;
        }
        setInterval(updateTime, 1000); updateTime();

        // å•Ÿå‹•
        async function init() {
            await Promise.all([fetchHeroWeather(), fetchHeroNews()]);
        }
        init();
        setInterval(init, 180000); // 3åˆ†é˜
    </script>
</body>
</html>
