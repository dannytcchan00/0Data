<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hong Kong Live Road Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  background:#050510;color:#e0e0e0;min-height:100vh;padding:2rem 0;
}
.row1{
  display:grid;grid-template-columns:20% 80%;gap:1.5rem;
  max-width:1400px;margin:0 auto 1.5rem auto;padding:0 2rem;height:420px;
}
.row2{
  display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;
  max-width:1400px;margin:0 auto;padding:0 2rem;height:425px;
}
.row3{
  max-width:1400px;margin:1.5rem auto 1rem;display:flex;
  padding:0 2rem;
}

/* Weather (no title text now) */
.weather-hero{
  background:radial-gradient(circle at top left,#284073,#151528);
  border-radius:24px;padding:1.8rem 1.5rem;
  box-shadow:0 12px 40px rgba(0,0,0,0.55);
  display:flex;flex-direction:column;justify-content:center;
  text-align:center;position:relative;overflow:hidden;
}
.weather-hero::before{
  content:'üå§Ô∏è';font-size:3.5rem;position:absolute;top:10px;right:10px;opacity:.18;
}
.weather-icon{font-size:2.5rem;margin-bottom:.3rem;}
.weather-temp{font-size:3.8rem;font-weight:300;color:#fff;margin-bottom:.5rem;letter-spacing:-2px;}
.weather-desc{font-size:1.3rem;color:#d0e4ff;margin-bottom:.8rem;font-weight:500;}
.weather-details{font-size:1rem;color:#b3d9ff;}
.weather-warning{
  background:linear-gradient(45deg,#ff6b6b,#ffb36b);color:#fff;
  padding:.6rem 1.2rem;border-radius:20px;font-weight:600;
  margin-top:.8rem;font-size:.85rem;
}

/* News */
.news-hero{
  background:#161623;border-radius:24px;padding:1.8rem 2rem;
  box-shadow:0 12px 40px rgba(0,0,0,0.6);overflow-y:auto;
  backdrop-filter:blur(10px);display:flex;flex-direction:column;
  font-size:.85rem;line-height:1.3;border:1px solid #26263a;
}
.hero-title{color:#fff;font-size:1.2rem;font-weight:700;margin-bottom:.8rem;}
.news-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.3rem;}
.news-item{
  padding:1rem 0;border-bottom:1px solid #303046;cursor:pointer;
  transition:all .25s ease;display:flex;align-items:flex-start;gap:.9rem;
}
.news-item:hover{
  background:rgba(76,175,80,0.12);border-radius:14px;
  padding:1rem 1.4rem 1rem 1.7rem;transform:translateX(4px);
  border-left:3px solid #4caf50;box-shadow:0 4px 15px rgba(0,0,0,0.5);
}
.news-content{flex:1;}
.news-title{color:#fff;font-weight:600;font-size:.95rem;line-height:1.3;margin-bottom:.2rem;}
.news-source{color:#ff8a80;font-size:.8rem;font-weight:700;}
.news-time{color:#888;font-size:.7rem;margin-top:.15rem;}
.news-badge{
  background:#4caf50;color:#fff;padding:.15rem .5rem;border-radius:12px;
  font-size:.65rem;font-weight:700;align-self:flex-start;margin-left:.5rem;
  line-height:1;margin-top:.3rem;
}

/* Generic panel */
.panel{
  border-radius:24px;display:flex;flex-direction:column;
  box-shadow:0 12px 40px rgba(0,0,0,0.6);overflow:hidden;
}
.panel-header{
  color:#fff;font-size:1.05rem;font-weight:700;
  padding:1rem 1rem .7rem;text-align:center;
  border-bottom:1px solid rgba(255,255,255,0.15);
}
.panel-content{
  flex:1;overflow-y:auto;padding:1rem 1rem 1.1rem;font-size:.76rem;
}

/* Tunnels */
.tunnel-panel{background:#1c1c30;border:1px solid #2f3250;color:#e3e8ff;}
.tunnel-header{background:linear-gradient(135deg,#2d4373,#1a1f3d);color:#aad4ff;}
.table-peak{font-size:.7rem;color:#ffc107;text-align:center;padding:.3rem 0;}
.tunnel-row{
  display:grid;
  grid-template-columns:1.5fr 1.1fr 1.1fr 1.05fr 1.15fr 1.5fr;
  gap:.15rem;align-items:center;padding:.44rem .3rem;
  margin-bottom:.25rem;border-radius:8px;
}
.tunnel-row.header{
  background:#262647;font-weight:700;color:#f3f6ff;
  position:sticky;top:0;z-index:1;
}
.tunnel-row.nth-child(even){background:#222244;}
.tunnel-row.nth-child(odd){background:#292953;}
.tunnel-name{
  font-weight:700;font-size:.8rem;color:#fffceb;cursor:pointer;
  text-decoration:underline;
}
.tunnel-name:hover{color:#51c4fc;}
.toll-cell{
  font-size:.78rem;text-align:center;padding:.2rem .38rem;
  background:#335599;color:#e0e0e0;border-radius:6px;
}
.speed-cell{
  font-weight:700;font-size:.82rem;padding:.2rem .5rem;
  border-radius:8px;text-align:center;
}
.speed-good{background:#3a7d44;color:#c4efc4;}
.speed-slow{background:#c08a00;color:#fff4b1;}
.speed-congested{background:#a23939;color:#f7caca;}

/* Major roads */
.road-panel{background:#1a2f2a;border:1px solid #2f4a40;color:#d4f0d4;}
.road-header{background:linear-gradient(135deg,#2d5a4a,#1a332e);color:#a8e6a8;}
.road-item{
  display:flex;justify-content:space-between;align-items:center;
  padding:.6rem 0;border-bottom:1px solid rgba(255,255,255,0.12);
  cursor:pointer;transition:background .18s;
}
.road-item:hover{background:#2f4752;border-radius:10px;}
.road-name{font-weight:600;}
.road-speed{
  font-weight:700;padding:.25rem .7rem;border-radius:10px;
  min-width:3.8rem;text-align:center;
}

/* Traffic */
.traffic-panel{background:#2a1717;border:1px solid #4a2a2a;color:#ffd4d4;}
.traffic-header{background:linear-gradient(135deg,#4a1f1f,#2a1717);color:#ffb3b3;}
.traffic-item{
  padding:.7rem 0;border-bottom:1px solid rgba(255,255,255,0.15);
  display:flex;align-items:flex-start;gap:.5rem;
}
.traffic-icon{font-size:1.1rem;min-width:1.3rem;flex-shrink:0;}
.traffic-text{flex:1;line-height:1.35;}
.traffic-title{font-weight:600;margin-bottom:.1rem;font-size:.75rem;}
.traffic-time{color:rgba(255,230,240,0.85);font-size:.68rem;}

.loading,.no-data{
  color:#888;text-align:center;padding:2rem 1rem;font-style:italic;
}
.error{color:#ff6b6b;text-align:center;padding:2rem 1rem;font-weight:500;}

/* Immigration block */
.imm-panel{
  background:#212338;border-radius:24px;padding:1.2rem 1.4rem;
  color:#d0d0ff;box-shadow:0 8px 30px rgba(33,35,56,0.5);width:100%;
}
.imm-title{
  color:#7facff;margin-bottom:1rem;font-weight:700;
  font-size:1.1rem;
}
.imm-item{margin-bottom:.4rem;font-size:.9rem;}

/* Modals */
.modal,.road-modal{
  display:none;position:fixed;z-index:2100;left:0;top:0;
  width:100vw;height:100vh;background:rgba(0,15,44,0.89);
  backdrop-filter:blur(10px);
}
.modal-content,.road-modal-content{
  background:#273239;margin:5vh auto;padding:2.3rem 2.6rem;border-radius:26px;
  width:90vw;max-width:540px;max-height:75vh;color:#ececec;
  overflow-y:auto;box-shadow:0 16px 64px rgba(0,0,0,0.85);
}
.modal-header,.road-modal-head{
  display:flex;align-items:baseline;justify-content:space-between;
  margin-bottom:1rem;
}
.modal-title,.road-modal-title{font-size:1.18rem;font-weight:700;margin-bottom:.3rem;}
.modal-source,.modal-time,.road-modal-label{
  font-size:.93rem;color:#aee1ff;margin-top:.2rem;font-weight:600;
}
.modal-close,.road-modal-close{
  font-size:2.07rem;font-weight:bold;color:#bbb;cursor:pointer;
}
.modal-close:hover,.road-modal-close:hover{color:#fff;}
.modal-section,.road-modal-section{margin-bottom:1.1rem;font-size:.9rem;}
.modal-map,.road-modal-map{margin:1rem 0;}

@media(max-width:1200px){
  .row1{grid-template-columns:1fr;height:auto;}
  .row2{grid-template-columns:1fr;height:auto;}
  .row3{padding:0 1rem;}
  .news-hero{font-size:.8rem;}
}
</style>
</head>
<body>

<section class="row1">
  <div class="weather-hero">
    <!-- Â∑≤ÁßªÈô§ Weather (OpenWeatherMap) Ê®ôÈ°åË°å -->
    <div class="weather-icon" id="weatherIcon">üå§Ô∏è</div>
    <div class="weather-temp" id="weatherTemp">--¬∞C</div>
    <div class="weather-desc" id="weatherDesc">--</div>
    <div class="weather-details" id="weatherDetails">Hong Kong</div>
    <div id="weatherWarning"></div>
  </div>
  <div class="news-hero">
    <div class="news-header">
      <div class="hero-title">Hong Kong News</div>
      <span id="newsCount">(0)</span>
    </div>
    <div id="heroNews"><div class="loading">Loading latest news...</div></div>
  </div>
</section>

<section class="row2">
  <div class="panel tunnel-panel">
    <div class="panel-header tunnel-header">Tunnels ‚Äì Tolls & Speeds</div>
    <div class="table-peak" id="peakStatus">Loading...</div>
    <div class="panel-content" id="tunnelTable">
      <div class="no-data">Loading tunnels...</div>
    </div>
  </div>

  <div class="panel road-panel">
    <div class="panel-header road-header">Major Roads</div>
    <div class="panel-content" id="majorRoadSpeeds">
      <div class="no-data">Loading roads...</div>
    </div>
  </div>

  <div class="panel traffic-panel">
    <div class="panel-header traffic-header">Traffic News</div>
    <div class="panel-content" id="trafficNews">
      <div class="no-data">Loading traffic...</div>
    </div>
  </div>
</section>

<section class="row3">
  <div class="imm-panel">
    <div class="imm-title">Immigration Checkpoint Waiting Times</div>
    <div id="immigrationWaitTimes">
      <div style="text-align:center;color:#888;">Loading waiting times...</div>
    </div>
  </div>
</section>

<!-- News modal -->
<div id="newsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div>
        <span class="modal-title" id="modalTitle">Loading...</span>
        <span class="modal-source" id="modalSource"></span>
        <span class="modal-time" id="modalTime"></span>
      </div>
      <span class="modal-close" id="modalClose">&times;</span>
    </div>
    <div class="modal-section" id="modalDescription"></div>
  </div>
</div>

<!-- Tunnel / Road modal -->
<div id="roadModal" class="road-modal">
  <div class="road-modal-content">
    <div class="road-modal-head">
      <span class="road-modal-title" id="roadModalTitle">Title</span>
      <span class="road-modal-close" id="roadModalClose">&times;</span>
    </div>
    <div class="road-modal-section">
      <span class="road-modal-label">Location:</span> <span id="roadModalLoc"></span>
    </div>
    <div class="road-modal-section">
      <span class="road-modal-label">Length:</span> <span id="roadModalLen"></span>
    </div>
    <div class="road-modal-section">
      <span class="road-modal-label">History:</span> <span id="roadModalHis"></span>
    </div>
    <div class="road-modal-map" id="roadModalMap">
      <span style="font-size:0.8rem;opacity:0.8;">(Map placeholder ‚Äì embed map later)</span>
    </div>
  </div>
</div>

<script>
const OW_API_KEY = 'f19c9c1cfbb572c048a0a99c38f012d2';
let newsData = [];

// Utility
function kmhToMph(kmh){return Math.round(kmh*0.621371);}

// Text info only
const tunnelDetails = {
  'CHT': {
    name:'Cross-Harbour Tunnel',
    length:'1.8 km',
    location:'Hung Hom ‚Äì Causeway Bay',
    history:'First road tunnel under Victoria Harbour, opened in 1972.'
  },
  'EHC': {
    name:'Eastern Harbour Crossing',
    length:'2.2 km',
    location:'Lam Tin ‚Äì Quarry Bay',
    history:'Immersed tube harbour tunnel opened in 1989.'
  },
  'WHC': {
    name:'Western Harbour Crossing',
    length:'2.0 km',
    location:'West Kowloon ‚Äì Sai Ying Pun',
    history:'Part of Route 3, opened in 1997.'
  },
  'TLT': {
    name:'Tai Lam Tunnel',
    length:'3.8 km',
    location:'Ting Kau ‚Äì Pat Heung',
    history:'Dual three-lane tunnel in New Territories, opened in 1998.'
  }
};

const roadDetails = {
  'Tsing Sha Hwy':{
    name:'Tsing Sha Highway',
    length:'Approx. 15 km',
    location:'Tsing Yi ‚Äì Sha Tin',
    history:'Key section of Route 8 completed between 2005 and 2009.'
  },
  'West Kowloon Corridor':{
    name:'West Kowloon Corridor',
    length:'Approx. 4.5 km',
    location:'Mong Kok ‚Äì Sham Shui Po ‚Äì Cheung Sha Wan',
    history:'Elevated corridor serving west Kowloon since late 1970s.'
  },
  'Island Eastern Corridor':{
    name:'Island Eastern Corridor',
    length:'Approx. 9 km',
    location:'North Point ‚Äì Chai Wan',
    history:'Coastal highway along north shore of Hong Kong Island.'
  },
  'Tsing Kwai Hwy':{
    name:'Tsing Kwai Highway',
    length:'Approx. 6 km',
    location:'Tsing Yi ‚Äì Kwai Chung / Cheung Sha Wan',
    history:'Important Route 3 link between New Territories and urban area.'
  },
  'North Lantau Hwy':{
    name:'North Lantau Highway',
    length:'Approx. 12 km',
    location:'Tsing Ma Bridge ‚Äì Tung Chung',
    history:'Airport core project road opened in 1997.'
  },
  'Tsuen Mun Rd':{
    name:'Tsuen Mun Road',
    length:'Approx. 20 km',
    location:'Tsuen Wan ‚Äì Tuen Mun',
    history:'One of Hong Kong‚Äôs earliest high-speed roads.'
  },
  'Kwun Tong Rd':{
    name:'Kwun Tong Road',
    length:'Approx. 4 km',
    location:'Kowloon East ‚Äì Kwun Tong',
    history:'Main urban road serving industrial/commercial areas.'
  }
};

function openInfoModal(title,loc,len,his){
  document.getElementById('roadModalTitle').textContent = title;
  document.getElementById('roadModalLoc').textContent = loc || '-';
  document.getElementById('roadModalLen').textContent = len || '-';
  document.getElementById('roadModalHis').textContent = his || '-';
  document.getElementById('roadModal').style.display = 'block';
}
function showTunnelModal(key){
  const info = tunnelDetails[key]; if(!info) return;
  openInfoModal(info.name,info.location,info.length,info.history);
}
function showRoadModal(name){
  const info = roadDetails[name]; if(!info) return;
  openInfoModal(info.name,info.location,info.length,info.history);
}

// 1. Tunnels ‚Äì HKD + mph
async function updateTunnelTable(){
  const container = document.getElementById('tunnelTable');
  const peakStatus = document.getElementById('peakStatus');
  const now = new Date();
  const isWeekday = now.getDay()!==0 && now.getDay()!==6;
  const h = now.getHours(), m = now.getMinutes();
  const isPeak = isWeekday && ((h>=7 && h<10) || (h===10 && m<=15) || (h>=16 && h<19));
  peakStatus.innerHTML = isPeak ? 'üî¥ Peak hours' : 'üü¢ Off-peak';

  const tolls = {
    'CHT':{private:isPeak?45:25,moto:isPeak?20:15,taxi:isPeak?45:25,other:isPeak?60:40},
    'EHC':{private:isPeak?45:25,moto:isPeak?20:15,taxi:isPeak?45:25,other:isPeak?60:40},
    'WHC':{private:isPeak?70:50,moto:isPeak?35:25,taxi:isPeak?70:50,other:isPeak?90:70},
    'TLT':{private:isPeak?55:40,moto:isPeak?25:20,taxi:isPeak?55:40,other:isPeak?80:60}
  };

  let speeds;
  try{
    const resp = await fetch('https://resource.data.one.gov.hk/td/traffic-speed-map/en/tunnels.json',{cache:'no-cache'});
    const data = await resp.json();
    speeds = {
      'CHT':{klnToHK:kmhToMph(data?.cht?.klnToHk?.speed || 45),hkToKln:kmhToMph(data?.cht?.hkToKln?.speed || 45)},
      'EHC':{klnToHK:kmhToMph(data?.ehc?.klnToHk?.speed || 55),hkToKln:kmhToMph(data?.ehc?.hkToKln?.speed || 55)},
      'WHC':{klnToHK:kmhToMph(data?.whc?.klnToHk?.speed || 50),hkToKln:kmhToMph(data?.whc?.hkToKln?.speed || 50)},
      'TLT':{klnToHK:kmhToMph(70),hkToKln:kmhToMph(68)}
    };
  }catch(e){
    speeds = {
      'CHT':{klnToHK:kmhToMph(42),hkToKln:kmhToMph(42)},
      'EHC':{klnToHK:kmhToMph(46),hkToKln:kmhToMph(48)},
      'WHC':{klnToHK:kmhToMph(48),hkToKln:kmhToMph(44)},
      'TLT':{klnToHK:kmhToMph(70),hkToKln:kmhToMph(68)}
    };
  }

  let html = `
    <div class="tunnel-row header">
      <span>Tunnel</span>
      <span>Private Car</span>
      <span>Motorcycle</span>
      <span>Taxi</span>
      <span>Other Vehicles</span>
      <span>Speed (mph)</span>
    </div>
  `;
  ['CHT','EHC','WHC','TLT'].forEach(key=>{
    const fees = tolls[key], s = speeds[key];
    const avg = Math.round((s.klnToHK+s.hkToKln)/2);
    const cls = avg>=31?'speed-good':avg>=19?'speed-slow':'speed-congested';
    const name = tunnelDetails[key].name;
    html += `
      <div class="tunnel-row data">
        <span class="tunnel-name" onclick="showTunnelModal('${key}')">${name}</span>
        <span class="toll-cell">HK$${fees.private}</span>
        <span class="toll-cell">HK$${fees.moto}</span>
        <span class="toll-cell">HK$${fees.taxi}</span>
        <span class="toll-cell">HK$${fees.other}</span>
        <span class="speed-cell ${cls}">${s.klnToHK}‚Üî${s.hkToKln}</span>
      </div>
    `;
  });
  container.innerHTML = html;
}

// 2. Major roads
async function updateMajorRoadSpeeds(){
  const container = document.getElementById('majorRoadSpeeds');
  const list = [
    'Tsing Sha Hwy',
    'West Kowloon Corridor',
    'Island Eastern Corridor',
    'Tsing Kwai Hwy',
    'North Lantau Hwy',
    'Tsuen Mun Rd',
    'Kwun Tong Rd'
  ];
  try{
    const resp = await fetch('https://resource.data.one.gov.hk/td/traffic-speed-map/en/roads.json',{cache:'no-cache'});
    const data = await resp.json();
    let html = '';
    list.forEach(name=>{
      const key = name.replace(/\s+/g,'').toLowerCase();
      const r = data[key];
      const kmh = (r && r.length)?r[0].speed:null;
      const mph = kmh?kmhToMph(kmh):null;
      const cls = mph>=31?'speed-good':mph>=19?'speed-slow':'speed-congested';
      const color = cls==='speed-good'?'#3a7d44':cls==='speed-slow'?'#c08a00':'#a23939';
      html += `
        <div class="road-item" onclick="showRoadModal('${name}')">
          <span class="road-name">${roadDetails[name].name}</span>
          <span class="road-speed" style="background:${color};color:#fff;">
            ${mph!==null?mph+' mph':'--'}
          </span>
        </div>
      `;
    });
    container.innerHTML = html || '<div class="no-data">No road data</div>';
  }catch(e){
    const mock=[30,34,39,31,40,32,25];
    let html='';
    list.forEach((name,i)=>{
      const mph=mock[i];
      const cls=mph>=31?'speed-good':mph>=19?'speed-slow':'speed-congested';
      const color=cls==='speed-good'?'#3a7d44':cls==='speed-slow'?'#c08a00':'#a23939';
      html+=`
        <div class="road-item" onclick="showRoadModal('${name}')">
          <span class="road-name">${roadDetails[name].name}</span>
          <span class="road-speed" style="background:${color};color:#fff;">
            ${mph} mph
          </span>
        </div>
      `;
    });
    container.innerHTML=html;
  }
}

// 3. Traffic news ‚Äì specialtrafficnews.xml
async function updateTrafficNews(){
  const container=document.getElementById('trafficNews');
  try{
    const resp=await fetch('https://resource.data.one.gov.hk/td/en/specialtrafficnews.xml',{cache:'no-cache'});
    const text=await resp.text();
    const parser=new DOMParser();
    const xmlDoc=parser.parseFromString(text,'text/xml');
    const messages=xmlDoc.getElementsByTagName('message');
    let html='';
    Array.from(messages).slice(0,10).forEach(msg=>{
      const engShort=msg.getElementsByTagName('EngShort')[0]?.textContent.trim() || '';
      const refDate=msg.getElementsByTagName('ReferenceDate')[0]?.textContent.trim() || '';
      if(!engShort) return;
      let icon='üö®';
      const lower=engShort.toLowerCase();
      if(lower.includes('tunnel')) icon='üöá';
      else if(lower.includes('road')) icon='üõ£Ô∏è';
      html+=`
        <div class="traffic-item">
          <span class="traffic-icon">${icon}</span>
          <div class="traffic-text">
            <div class="traffic-title">${engShort}</div>
            <div class="traffic-time">${refDate}</div>
          </div>
        </div>
      `;
    });
    container.innerHTML=html || '<div class="no-data">No special traffic news</div>';
  }catch(e){
    container.innerHTML='<div class="no-data">Traffic news unavailable</div>';
  }
}

// 4. Weather
async function updateWeather(){
  try{
    const resp=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=22.3964&lon=114.1095&appid=${OW_API_KEY}&units=metric&lang=en`);
    const data=await resp.json();
    if(data.cod===200){
      const t=Math.round(data.main.temp);
      const feels=Math.round(data.main.feels_like);
      const hum=data.main.humidity;
      const windMph=Math.round(data.wind.speed*2.23694);
      const desc=data.weather[0].description;
      const cap=desc.charAt(0).toUpperCase()+desc.slice(1);
      const iconCode=data.weather[0].icon;
      const icons={'01d':'‚òÄÔ∏è','01n':'üåô','02d':'‚õÖ','02n':'‚õÖ','03d':'‚òÅÔ∏è','03n':'‚òÅÔ∏è','04d':'‚òÅÔ∏è','04n':'‚òÅÔ∏è','09d':'üå¶Ô∏è','09n':'üå¶Ô∏è','10d':'üåßÔ∏è','10n':'üåßÔ∏è','11d':'‚õàÔ∏è','11n':'‚õàÔ∏è','13d':'‚ùÑÔ∏è','13n':'‚ùÑÔ∏è','50d':'üå´Ô∏è','50n':'üå´Ô∏è'};
      document.getElementById('weatherIcon').textContent=icons[iconCode]||'üå§Ô∏è';
      document.getElementById('weatherTemp').textContent=`${t}¬∞C`;
      document.getElementById('weatherDesc').textContent=`${cap} ‚Ä¢ ${hum}%`;
      document.getElementById('weatherDetails').textContent=`Feels ${feels}¬∞C ‚Ä¢ Wind ${windMph} mph`;
      let warn='';
      if(t>33) warn='Very hot';
      else if(t<12) warn='Very cold';
      else if(hum>90) warn='Very humid';
      else if(data.weather[0].main==='Rain') warn='Rainy';
      document.getElementById('weatherWarning').innerHTML = warn?`<div class="weather-warning">${warn}</div>`:'';
    }
  }catch(e){}
}

// 5. News (SCMP)
async function updateNews(){
  const container=document.getElementById('heroNews');
  const countEl=document.getElementById('newsCount');
  container.innerHTML='<div class="loading">Loading latest news...</div>';
  try{
    const resp=await fetch('https://api.allorigins.win/raw?url='+encodeURIComponent('https://www.scmp.com/rss/91/feed'));
    const text=await resp.text();
    const parser=new DOMParser();
    const xmlDoc=parser.parseFromString(text,'text/xml');
    const items=xmlDoc.getElementsByTagName('item');
    newsData=[];let html='';
    Array.from(items).slice(0,12).forEach((item,i)=>{
      const title=item.getElementsByTagName('title')[0]?.textContent.trim()||'';
      const pub=item.getElementsByTagName('pubDate')[0]?.textContent||'';
      const date=pub?new Date(pub):new Date();
      newsData.push({title,pubDate:date,index:i});
      const short=title.length>80?title.substring(0,80)+'...':title;
      html+=`
        <div class="news-item" onclick="openNewsModal(${i})">
          <div class="news-content">
            <div class="news-title">${short}</div>
            <div class="news-source">SCMP</div>
            <div class="news-time">${date.toLocaleDateString('en-GB')}</div>
          </div>
          <span class="news-badge">NEW</span>
        </div>
      `;
    });
    container.innerHTML=html;
    countEl.textContent=`(${newsData.length})`;
  }catch(e){
    container.innerHTML='<div class="error">News loading failed.</div>';
  }
}
function openNewsModal(i){
  const n=newsData[i];if(!n) return;
  document.getElementById('modalTitle').textContent=n.title;
  document.getElementById('modalSource').textContent='SCMP';
  document.getElementById('modalTime').textContent=n.pubDate?n.pubDate.toLocaleString('en-GB'):'';
  document.getElementById('modalDescription').textContent='Full article available on SCMP website.';
  document.getElementById('newsModal').style.display='block';
}

// 6. Immigration waiting times ‚Äì you plug in your own API here
async function updateImmigrationWaitTimes(){
  const container=document.getElementById('immigrationWaitTimes');
  try{
    // TODO: ÊèõÊàê‰Ω†ÂØ¶ÈöõÁöÑ API endpoint
    // const resp = await fetch('https://your-api/immigration-wait-times',{cache:'no-cache'});
    // const data = await resp.json();
    // Á§∫ÁØÑÂÅáÊï∏Êìö
    const data = {
      checkpoints:[
        {name:'Lok Ma Chau Spur Line', wait:15},
        {name:'Lo Wu', wait:25},
        {name:'Shenzhen Bay', wait:10},
        {name:'Hong Kong-Zhuhai-Macao Bridge', wait:8}
      ]
    };
    let html='';
    data.checkpoints.forEach(cp=>{
      html+=`<div class="imm-item"><strong>${cp.name}</strong>: ${cp.wait} min</div>`;
    });
    container.innerHTML=html||'<div class="no-data">No data</div>';
  }catch(e){
    container.innerHTML='<div style="text-align:center;color:#a66;">Failed to load waiting times.</div>';
  }
}

// Modal close binding
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('modalClose').onclick=()=>{document.getElementById('newsModal').style.display='none';};
  document.getElementById('roadModalClose').onclick=()=>{document.getElementById('roadModal').style.display='none';};
});
window.onclick=e=>{
  if(e.target===document.getElementById('newsModal')) document.getElementById('newsModal').style.display='none';
  if(e.target===document.getElementById('roadModal')) document.getElementById('roadModal').style.display='none';
};

// Start all
updateWeather();
updateNews();
updateTunnelTable();
updateMajorRoadSpeeds();
updateTrafficNews();
updateImmigrationWaitTimes();

setInterval(updateWeather,300000);
setInterval(updateNews,300000);
setInterval(updateTunnelTable,30000);
setInterval(updateMajorRoadSpeeds,30000);
setInterval(updateTrafficNews,120000);
setInterval(updateImmigrationWaitTimes,60000);
</script>
</body>
</html>
