<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hong Kong Live Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #121212; color: #e0e0e0; line-height: 1.6; 
        }
        .header { 
            background: linear-gradient(135deg, #1e3c72, #2a5298); 
            padding: 1rem; text-align: center; 
        }
        .dashboard { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 1.5rem; max-width: 1200px; margin: 2rem auto; padding: 0 1rem; 
        }
        .card { 
            background: #1e1e1e; border-radius: 12px; padding: 1.5rem; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.3); transition: transform 0.3s; 
        }
        .card:hover { transform: translateY(-5px); }
        .card h3 { color: #4fc3f7; margin-bottom: 1rem; font-size: 1.2rem; }
        .status { font-size: 1.1rem; font-weight: bold; color: #4fc3f7; }
        .news-item { 
            padding: 0.8rem 0; border-bottom: 1px solid #333; 
            cursor: pointer; transition: all 0.2s; 
        }
        .news-item:hover { background: #2a2a2a; border-radius: 6px; padding-left: 0.5rem; }
        .news-title { color: #ffffff; font-weight: bold; font-size: 1rem; margin-bottom: 0.3rem; }
        .news-source { color: #4fc3f7; font-size: 0.85rem; font-weight: 500; }
        .news-time { color: #888; font-size: 0.8rem; }
        .widget { 
            position: fixed; top: 20px; right: 20px; 
            background: #0d47a1; color: white; padding: 1rem; 
            border-radius: 10px; min-width: 200px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); 
            z-index: 1000; 
        }
        .loading { color: #888; }
        .error { color: #ff6b6b; }
        @media (max-width: 768px) { 
            .dashboard { grid-template-columns: 1fr; } 
            .widget { position: static; margin: 1rem; } 
        }
    </style>
</head>
<body>
    <div class="widget" id="liveWidget">
        <div>Hong Kong Time: <span id="hkTime"></span></div>
        <div>Weather: <span id="quickWeather">Loading...</span></div>
        <div>Last Update: <span id="lastUpdate"></span></div>
    </div>

    <header class="header">
        <h1>Hong Kong Live Information Dashboard</h1>
        <p>Real-time updates from multiple RSS feeds, weather & more</p>
    </header>

    <main class="dashboard">
        <section class="card">
            <h3>üì∞ Latest News (Multi-RSS)</h3>
            <div id="news">Loading RSS feeds...</div>
        </section>

        <section class="card">
            <h3>üå§Ô∏è Current Weather</h3>
            <div id="weather">Loading weather data...</div>
        </section>

        <section class="card">
            <h3>üõ£Ô∏è Live Traffic</h3>
            <div id="traffic">Loading traffic data...</div>
        </section>

        <section class="card">
            <h3>üè• A&E Waiting Times</h3>
            <div id="aewait">Loading A&E data...</div>
        </section>
    </main>

    <script>
        // üî• ‰Ω†Êèê‰æõÂòÖ4Ê¢ùRSS feeds
        const RSS_FEEDS = [
            { url: 'https://feeds.hongkongherald.com/rss/b82693edf38ebff8', name: 'Hong Kong Herald' },[attached_file:1]
            { url: 'https://www.scmp.com/rss/91/feed/', name: 'SCMP' },[web:33]
            { url: 'https://www.hongkongfp.com/feed/', name: 'HKFP' },
            { url: 'https://feeds.bbci.co.uk/news/rss.xml?edition=uk', name: 'BBC HK' } // BBC HK topic RSS
        ];

        // ÂñÆÊ¢ùRSS parserÔºàËôïÁêÜCDATAÂêåÊôÇÈñìÔºâ
        async function fetchSingleRSS(feed) {
            try {
                const response = await fetch(feed.url);
                const text = await response.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, "text/xml");
                
                const items = Array.from(xml.querySelectorAll("item")).slice(0, 5).map(item => {
                    const titleEl = item.querySelector("title");
                    const title = titleEl ? titleEl.textContent || titleEl.firstChild?.textContent || 'No title' : 'No title';
                    
                    return {
                        title: title.replace(/\s+/g, ' ').trim(),
                        link: item.querySelector("link")?.textContent || '#',
                        pubDate: new Date(item.querySelector("pubDate")?.textContent || Date.now()),
                        source: feed.name,
                        description: item.querySelector("description")?.textContent?.substring(0, 120) + '...'
                    };
                });
                
                return items;
            } catch (e) {
                console.error(`Failed to fetch ${feed.url}:`, e);
                return [];
            }
        }

        // üî• Â§öRSSËÅöÂêà‰∏ªÂáΩÊï∏
        async function fetchNews() {
            const newsDiv = document.getElementById('news');
            newsDiv.innerHTML = '<div class="loading">Loading from 4 RSS feeds...</div>';

            try {
                const allPromises = RSS_FEEDS.map(feed => fetchSingleRSS(feed));
                const allItemsArrays = await Promise.all(allPromises);
                let allItems = allItemsArrays.flat().filter(item => item.title !== 'No title');

                // ÊåâÊôÇÈñìÊéíÂ∫èÔºàÊúÄÊñ∞Âú®ÂâçÔºâÔºåÂéªÈáç
                allItems.sort((a, b) => b.pubDate - a.pubDate);
                const uniqueItems = [];
                const seenLinks = new Set();
                allItems.forEach(item => {
                    if (!seenLinks.has(item.link) && uniqueItems.length < 10) {
                        seenLinks.add(item.link);
                        uniqueItems.push(item);
                    }
                });

                if (uniqueItems.length === 0) {
                    newsDiv.innerHTML = '<div class="error">No news items found</div>';
                    return;
                }

                let html = `<div class="status">${uniqueItems.length} headlines from ${RSS_FEEDS.length} sources</div>`;
                uniqueItems.forEach(item => {
                    html += `
                        <div class="news-item" onclick="window.open('${item.link}', '_blank')" title="${item.description}">
                            <div class="news-title">${item.title}</div>
                            <div class="news-source">${item.source}</div>
                            <div class="news-time">${item.pubDate.toLocaleString('en-GB', { timeZone: 'Asia/Hong_Kong' })}</div>
                        </div>
                    `;
                });
                newsDiv.innerHTML = html;
            } catch (e) {
                newsDiv.innerHTML = `<div class="error">RSS aggregation failed: ${e.message}</div>`;
            }
        }

        // HKÊôÇÈñìwidget
        function updateTime() {
            const now = new Date().toLocaleString('en-GB', { timeZone: 'Asia/Hong_Kong' });
            document.getElementById('hkTime').textContent = now;
            document.getElementById('lastUpdate').textContent = now;
        }
        setInterval(updateTime, 1000); updateTime();

        // Â§©Ê∞£ÔºàHKOÔºâ
        async function fetchWeather() {
            try {
                const response = await fetch('https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=rhrread&lang=en');
                const data = await response.json();
                const temp = data.temperature.data[0]?.value || 'N/A';
                document.getElementById('weather').innerHTML = `
                    <div class="status">${temp}¬∞C - ${data.weatherDesc[0]}</div>
                    <div>Updated: ${new Date().toLocaleString('en-GB', { timeZone: 'Asia/Hong_Kong' })}</div>
                `;
                document.getElementById('quickWeather').textContent = `${temp}¬∞C`;
            } catch (e) {
                document.getElementById('weather').innerHTML = '<div class="error">Weather unavailable</div>';
            }
        }

        // ‰∫§ÈÄöÂêåÊÄ•ÁóáÂÆ§ÔºàÈÄ£ÁµêÁâàÔºâ
        function fetchTraffic() {
            document.getElementById('traffic').innerHTML = 
                `<div class="status"><a href="https://www.td.gov.hk/en/traffic_notices/index_id_12052.html" target="_blank">Live Traffic Snapshot</a></div>
                 <div>Transport Department real-time road speeds</div>`;
        }

        function fetchAEWait() {
            document.getElementById('aewait').innerHTML = 
                `<div class="status"><a href="https://www.ha.org.hk/visitor/ha_visitor_index.asp?Content_ID=235504&Lang=ENG" target="_blank">Live A&E Waiting</a></div>
                 <div>43 public hospitals, updates every 15 minutes</div>`;
        }

        // ËºâÂÖ•ÊâÄÊúâ
        async function loadAll() {
            await Promise.all([fetchNews(), fetchWeather()]);
            fetchTraffic();
            fetchAEWait();
        }
        loadAll();
        setInterval(loadAll, 180000); // 3ÂàÜÈêòÊõ¥Êñ∞
    </script>
</body>
</html>
