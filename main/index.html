<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hong Kong Live Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  background:#050510;color:#e0e0e0;min-height:100vh;padding:2rem 0;
}
.row1{
  display:grid;grid-template-columns:22% 26% 26% 26%;
  gap:1.1rem;max-width:1400px;margin:0 auto 1.6rem auto;
  padding:0 2rem;height:310px;
}

/* Weather */
.weather-hero{
  background:radial-gradient(circle at top left,#284073,#151528);
  border-radius:24px;padding:1.2rem 1.4rem;box-shadow:0 12px 40px rgba(0,0,0,0.55);
  display:flex;flex-direction:column;justify-content:center;text-align:center;
  position:relative;overflow:hidden;height:100%;
}
.weather-hero::before{
  content:'ğŸŒ¤ï¸';font-size:3.2rem;position:absolute;top:12px;right:12px;opacity:.13;
}
.weather-icon{font-size:2.2rem;margin-bottom:.25rem;}
.weather-temp{font-size:3rem;font-weight:300;color:#fff;margin-bottom:.2rem;}
.weather-desc{font-size:1.1rem;color:#d0e4ff;margin-bottom:.3rem;font-weight:500;}
.weather-details{font-size:.95rem;color:#b3d9ff;}
.weather-warning{
  background:linear-gradient(45deg,#ff6b6b,#ffb36b);color:#fff;padding:.45rem 1.1rem;
  border-radius:20px;font-weight:600;margin-top:.8rem;font-size:.8rem;
}

/* News */
.news-hero{
  background:#161623;border-radius:24px;padding:1.2rem 1.15rem;box-shadow:0 12px 40px rgba(0,0,0,0.6);
  overflow-y:auto;backdrop-filter:blur(10px);display:flex;flex-direction:column;
  font-size:.82rem;line-height:1.25;border:1px solid #26263a;height:100%;
}
.hero-title{color:#fff;font-size:1.06rem;font-weight:700;margin-bottom:.32rem;}
.news-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.3rem;}
.news-count{font-size:.78rem;color:#aaa;}
.news-item{
  padding:.5rem 0;border-bottom:1px solid #303046;cursor:pointer;transition:all .15s ease;
  display:flex;align-items:flex-start;gap:.5rem;
}
.news-item:last-child{border-bottom:none;}
.news-item:hover{background:rgba(76,175,80,0.11);border-radius:10px;}
.news-content{flex:1;}
.news-title{color:#fff;font-weight:600;font-size:.87rem;line-height:1.18;margin-bottom:.1rem;}
.news-source{color:#ff8a80;font-size:.7rem;font-weight:600;}
.news-time{color:#888;font-size:.68rem;margin-top:.09rem;}

/* News Detail Modal */
.news-modal-overlay{
  display:none;position:fixed;z-index:3100;left:0;top:0;width:100vw;height:100vh;
  background:rgba(0,15,44,0.95);backdrop-filter:blur(15px);
}
.news-modal-content{
  background:#273347;margin:8vh auto;padding:2.2rem 2rem;border-radius:28px;
  width:92vw;max-width:650px;max-height:75vh;color:#ececec;overflow-y:auto;
  box-shadow:0 25px 80px rgba(0,0,0,0.9);
}
.news-modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;}
.news-modal-title{font-size:1.35rem;font-weight:700;margin-bottom:.3rem;}
.news-modal-source{font-size:.9rem;color:#7facff;}
.news-modal-time{font-size:.82rem;color:#9ab3ff;margin-top:.2rem;}
.news-modal-close{font-size:2.2rem;font-weight:bold;color:#bbb;cursor:pointer;padding:.3rem;}
.news-modal-close:hover{color:#fff;}
.news-modal-body{font-size:.92rem;line-height:1.6;}
.news-modal-desc{
  margin-top:1rem;padding:1.2rem;background:rgba(255,255,255,0.03);
  border-radius:12px;border:1px solid #3a4250;
}
.loading,.no-data{color:#888;text-align:center;padding:2.5rem;font-style:italic;}
.error{color:#ff6b6b;text-align:center;padding:2.5rem;font-weight:500;}

@media(max-width:1200px){
  .row1{grid-template-columns:1fr 1fr;height:auto;}
}
</style>
</head>
<body>

<!-- ç¬¬ä¸€è¡Œï¼šå¤©æ°£ + 3å€‹æ–°èï¼ˆé»æ“Šå¯ç‡è©³ç´°ï¼‰ -->
<section class="row1">
  <div class="weather-hero">
    <div class="weather-icon" id="weatherIcon">ğŸŒ¤ï¸</div>
    <div class="weather-temp" id="weatherTemp">--Â°C</div>
    <div class="weather-desc" id="weatherDesc">--</div>
    <div class="weather-details" id="weatherDetails">Hong Kong</div>
    <div id="weatherWarning"></div>
  </div>
  <div class="news-hero">
    <div class="news-header">
      <div class="hero-title">Hong Kong News</div>
      <span class="news-count" id="hkNewsCount">(0)</span>
    </div>
    <div id="hkNews"><div class="loading">Loading...</div></div>
  </div>
  <div class="news-hero">
    <div class="news-header">
      <div class="hero-title">International</div>
      <span class="news-count" id="intNewsCount">(0)</span>
    </div>
    <div id="intNews"><div class="loading">Loading...</div></div>
  </div>
  <div class="news-hero">
    <div class="news-header">
      <div class="hero-title">UK News</div>
      <span class="news-count" id="ukNewsCount">(0)</span>
    </div>
    <div id="ukNews"><div class="loading">Loading...</div></div>
  </div>
</section>

<!-- æ–°èè©³ç´°å…§å®¹æµ®å‹•æ¡† -->
<div id="newsModal" class="news-modal-overlay">
  <div class="news-modal-content">
    <div class="news-modal-header">
      <div>
        <div id="newsModalTitle" class="news-modal-title">Loading...</div>
        <div id="newsModalSource" class="news-modal-source"></div>
        <div id="newsModalTime" class="news-modal-time"></div>
      </div>
      <span class="news-modal-close" onclick="closeNewsModal()">&times;</span>
    </div>
    <div id="newsModalBody" class="news-modal-body">
      <div class="loading">Loading news details...</div>
    </div>
  </div>
</div>

<script>
const OW_API_KEY='f19c9c1cfbb572c048a0a99c38f012d2';
const cache=new Map();
const newsDataStore={};

// Proxy fetch
async function fetchViaProxy(url,key,isText=false,ttl=300000){
  const cached=cache.get(key);
  if(cached && Date.now()-cached.time<ttl) return cached.data;
  try{
    const res=await fetch('https://api.allorigins.win/raw?url='+encodeURIComponent(url),{cache:'no-cache'});
    const data=isText?await res.text():await res.json();
    cache.set(key,{data,time:Date.now()});
    return data;
  }catch(e){
    console.error('Fetch error',key,e);
    return null;
  }
}

// å¤©æ°£
async function loadWeather(){
  const url=`https://api.openweathermap.org/data/2.5/weather?lat=22.3964&lon=114.1095&appid=${OW_API_KEY}&units=metric&lang=en`;
  const data=await fetchViaProxy(url,'weather',false,300000);
  if(!data || data.cod!==200) return;
  const t=Math.round(data.main.temp);
  const feels=Math.round(data.main.feels_like);
  const hum=data.main.humidity;
  const wind=Math.round(data.wind.speed*3.6);
  const desc=data.weather[0].description.replace(/\b\w/g,c=>c.toUpperCase());
  const iconMap={'01d':'â˜€ï¸','01n':'ğŸŒ™','02d':'â›…','03d':'â˜ï¸','04d':'â˜ï¸','09d':'ğŸŒ¦ï¸','10d':'ğŸŒ§ï¸','11d':'â›ˆï¸','13d':'â„ï¸','50d':'ğŸŒ«ï¸'};
  const icon=iconMap[data.weather[0].icon]||'ğŸŒ¤ï¸';
  
  document.getElementById('weatherIcon').textContent=icon;
  document.getElementById('weatherTemp').textContent=`${t}Â°C`;
  document.getElementById('weatherDesc').textContent=`${desc} â€¢ ${hum}%`;
  document.getElementById('weatherDetails').textContent=`Feels ${feels}Â°C â€¢ ${wind} km/h`;
}

// æ–°è RSSï¼ˆå«é»æ“Šè©³ç´°åŠŸèƒ½ï¼‰
async function loadRSS(url,key,containerId,countId,sourceLabel){
  const text=await fetchViaProxy(url,key,true,300000);
  const container=document.getElementById(containerId);
  const countEl=document.getElementById(countId);
  if(!text){
    container.innerHTML='<div class="error">Unable to load news</div>';
    countEl.textContent='(0)';return;
  }
  const parser=new DOMParser();
  const xml=parser.parseFromString(text,'application/xml');
  const items=Array.from(xml.getElementsByTagName('item')).slice(0,10);
  let html='';let count=0;let itemIndex=0;
  
  items.forEach(item=>{
    const title=item.getElementsByTagName('title')[0]?.textContent?.trim()||'';
    const desc=item.getElementsByTagName('description')[0]?.textContent?.trim()||'';
    const link=item.getElementsByTagName('link')[0]?.textContent?.trim()||'';
    const pub=item.getElementsByTagName('pubDate')[0]?.textContent||'';
    
    if(!title)return;
    count++;
    itemIndex++;
    
    // å„²å­˜å®Œæ•´æ–°èæ•¸æ“š
    newsDataStore[`${key}_${itemIndex}`]={
      title,description:desc,link,pubDate:pub,source:sourceLabel
    };
    
    const short=title.length>80?title.slice(0,80)+'...':title;
    const d=pub?new Date(pub):null;
    
    html+=`<div class="news-item" onclick="showNewsDetail('${key}_${itemIndex}')">
      <div class="news-content">
        <div class="news-title">${short}</div>
        <div class="news-source">${sourceLabel}</div>
        <div class="news-time">${d?d.toLocaleString('en-GB'):''}</div>
      </div>
    </div>`;
  });
  
  container.innerHTML=html||'<div class="no-data">No news</div>';
  countEl.textContent=`(${count})`;
}

// æ–°èè©³ç´° modal
function closeNewsModal(){
  document.getElementById('newsModal').style.display='none';
}

function showNewsDetail(newsKey){
  const news=newsDataStore[newsKey];
  if(!news) return;
  
  document.getElementById('newsModalTitle').textContent=news.title;
  document.getElementById('newsModalSource').textContent=news.source;
  document.getElementById('newsModalTime').textContent=news.pubDate?new Date(news.pubDate).toLocaleString('en-GB'):'No date';
  
  document.getElementById('newsModalBody').innerHTML=`
    <div class="news-modal-desc">${news.description || 'No description available'}</div>
    ${news.link?`<div style="margin-top:1.2rem;">
      <a href="${news.link}" target="_blank" style="color:#4ad16a;font-weight:600;text-decoration:none;padding:.6rem 1rem;background:rgba(74,209,106,0.1);border-radius:8px;border:1px solid rgba(74,209,106,0.3);display:inline-block;">Read full article â†’</a>
    </div>`:''}
  `;
  
  document.getElementById('newsModal').style.display='block';
}

// Modal é»å¤–é¢é—œé–‰
window.addEventListener('click',e=>{
  if(e.target.id==='newsModal') closeNewsModal();
});

// åˆå§‹åŒ– + 5åˆ†é˜è‡ªå‹•æ›´æ–°
async function initFirstRow(){
  await loadWeather();
  await loadRSS('https://rthk9.rthk.hk/rthk/news/rss/e_expressnews_elocal.xml','rss_hk','hkNews','hkNewsCount','RTHK Local');
  await loadRSS('https://rthk9.rthk.hk/rthk/news/rss/e_expressnews_einternational.xml','rss_int','intNews','intNewsCount','RTHK World');
  await loadRSS('https://feeds.skynews.com/feeds/rss/uk.xml','rss_uk','ukNews','ukNewsCount','Sky News UK');
}

initFirstRow();
setInterval(initFirstRow,5*60*1000); // æ¯5åˆ†é˜è‡ªå‹•æ›´æ–°
</script>
</body>
</html>
