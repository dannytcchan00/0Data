name: æ¯æ—¥è‡ªå‹•æ›´æ–°å‡ºå…¥å¢ƒ CSV
on:
  schedule:
    - cron: '0 2 * * *'  # æ¯æ—¥é¦™æ¸¯æ™‚é–“10:00åŸ·è¡Œï¼ˆUTC 2:00ï¼‰
  workflow_dispatch:     # å…è¨±æ‰‹å‹•è§¸ç™¼

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4   # æª¢å‡ºç¨‹å¼ç¢¼

    - name: å»ºç«‹è³‡æ–™å¤¾åŠä¸‹è¼‰CSV
      run: |
        mkdir -p "0Data/Immigration Department/Immd/ControlPoint/data"
        curl -L -o "0Data/Immigration Department/Immd/ControlPoint/data/immigration.csv" "https://www.immd.gov.hk/opendata/eng/transport/immigration_clearance/statistics_on_daily_passenger_traffic.csv"

    - name: æª¢æŸ¥æª”æ¡ˆæœ‰ç„¡è®Šæ›´
      id: diff
      run: |
        git diff --quiet "0Data/Immigration Department/Immd/ControlPoint/data/immigration.csv" || echo "changed=true" >> $GITHUB_OUTPUT

    - name: æäº¤ä¸¦ push è®Šæ›´ï¼ˆå¦‚æœæœ‰æ›´æ–°ï¼‰
      if: steps.diff.outputs.changed == 'true'
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add "0Data/Immigration Department/Immd/ControlPoint/data/immigration.csv"
        git commit -m "ğŸ“Š è‡ªå‹•æ›´æ–°å‡ºå…¥å¢ƒ CSV $(date +'%Y-%m-%d')"
        git push
