name: Create Immd CSV

on:
  schedule:
    - cron: '0 2 * * *'    # æ¯æ—¥é¦™æ¸¯æ™‚é–“ 10:00 è‡ªå‹•åŸ·è¡Œ
  workflow_dispatch:     # æ‰‹å‹•æ¸¬è©¦æŒ‰éˆ•

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    
    - name: Create Immd CSV
      run: |
        mkdir -p "Immd/ControlPoint/data"
        curl -L -o "Immd/ControlPoint/data/immigration.csv" \
        "https://www.immd.gov.hk/opendata/eng/transport/immigration_clearance/statistics_on_daily_passenger_traffic.csv"
    
    - name: Check Differenet
      id: diff
      run: |
        git diff --quiet "Immd/ControlPoint/data/immigration.csv" || echo "changed=true" >> $GITHUB_OUTPUT
    
    - name: Commit Update
      if: steps.diff.outputs.changed == 'true'
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add "0Data/Immd/ControlPoint/data/immigration.csv"
        git commit -m "ðŸ“Š Create Immd CSV $(date +'%Y-%m-%d')"
        git push

