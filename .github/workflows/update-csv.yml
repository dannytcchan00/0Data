name: æ¯æ—¥è‡ªå‹•æ›´æ–°å‡ºå…¥å¢ƒ CSV

on:
  schedule:
    - cron: '0 2 * * *'    # æ¯æ—¥é¦™æ¸¯æ™‚é–“ 10:00 è‡ªå‹•åŸ·è¡Œ
  workflow_dispatch:     # æ‰‹å‹•æ¸¬è©¦æŒ‰éˆ•

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    
    - name: å»ºç«‹è³‡æ–™å¤¾ä¸¦ä¸‹è¼‰æœ€æ–° CSV
      run: |
        mkdir -p "0Data/Immd/ControlPoint/data"
        curl -L -o "0Data/Immd/ControlPoint/data/immigration.csv" \
        "https://www.immd.gov.hk/opendata/eng/transport/immigration_clearance/statistics_on_daily_passenger_traffic.csv"
    
    - name: æª¢æŸ¥æª”æ¡ˆæ˜¯å¦æœ‰è®Šæ›´
      id: diff
      run: |
        git diff --quiet "0Data/Immd/ControlPoint/data/immigration.csv" || echo "changed=true" >> $GITHUB_OUTPUT
    
    - name: Commit ä¸¦æ¨é€æ›´æ–°
      if: steps.diff.outputs.changed == 'true'
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add "0Data/Immd/ControlPoint/data/immigration.csv"
        git commit -m "ğŸ“Š è‡ªå‹•æ›´æ–°å‡ºå…¥å¢ƒ CSV $(date +'%Y-%m-%d')"
        git push

