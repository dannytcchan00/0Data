name: æ¯æ—¥è‡ªå‹•æ›´æ–°å‡ºå…¥å¢ƒ CSV

on:
  schedule:
    - cron: '0 2 * * *'    # æ¯æ—¥é¦™æ¸¯æ™‚é–“ 10:00
  workflow_dispatch:       # å…è¨±æ‰‹å‹•åŸ·è¡Œ

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: å»ºç«‹è³‡æ–™å¤¾ä¸¦ä¸‹è¼‰æœ€æ–° CSV
        run: |
          mkdir -p "Immd/ControlPoint/data"
          curl -L "https://www.immd.gov.hk/opendata/eng/transport/immigration_clearance/statistics_on_daily_passenger_traffic.csv" \
            -o "Immd/ControlPoint/data/immigration.csv"
          ls -R

      - name: æª¢æŸ¥æª”æ¡ˆæ˜¯å¦æœ‰è®Šæ›´
        id: diff
        run: |
          if git diff --quiet "Immd/ControlPoint/data/immigration.csv"; then
            echo "changed=false" >> $GITHUB_OUTPUT
          else
            echo "changed=true" >> $GITHUB_OUTPUT
          fi

      - name: Commit ä¸¦æ¨é€æ›´æ–°
        if: steps.diff.outputs.changed == 'true'
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add "Immd/ControlPoint/data/immigration.csv"
          git commit -m "ğŸ“Š è‡ªå‹•æ›´æ–°å‡ºå…¥å¢ƒ CSV $(date +'%Y-%m-%d %H:%M')"
          git push
