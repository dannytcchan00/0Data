name: Auto Download Immigration CSV

on:
  schedule:
    - cron: '0 1 * * *'  # æ¯æ—¥UTCæ™‚é–“1é»åŸ·è¡Œ (é¦™æ¸¯æ™‚é–“æ—©ä¸Š9é»)
  workflow_dispatch:  # å…è¨±æ‰‹å‹•è§¸ç™¼

jobs:
  download_and_commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup directories and download CSV
        run: |
          mkdir -p data/immi/immi_daily
          curl -L -o data/immi/immi_daily/data.csv \
            "https://www.immd.gov.hk/opendata/eng/transport/immigration_clearance/statistics_on_daily_passenger_traffic.csv"
          
          # é©—è­‰ä¸‹è¼‰æˆåŠŸ
          if [ -f data/immi/immi_daily/data.csv ] && [ -s data/immi/immi_daily/data.csv ]; then
            echo "âœ… CSV downloaded successfully (size: $(wc -c < data/immi/immi_daily/data.csv) bytes)"
          else
            echo "âŒ Download failed or empty file"
            exit 1
          fi

      - name: Commit and push if changed
        uses: EndBug/add-and-commit@v9
        with:
          add: 'data/immi/immi_daily/data.csv'
          message: 'ğŸ¤– Auto update immigration daily passenger traffic CSV - {{ github.event.head_commit.message }}'
          default_author: github_actions
