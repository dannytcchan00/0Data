<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦™æ¸¯å…¥å¢ƒå®¢æµé‡åœ°åœ–</title>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e6ed;
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        h1 {
            text-align: center; font-size: 2.2rem; margin-bottom: 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .map-container {
            height: 500px; margin-bottom: 25px;
            background: rgba(255,255,255,0.03); border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.1); overflow: hidden;
        }
        #map { height: 100%; width: 100%; }
        .status-bar {
            background: rgba(255,255,255,0.05); backdrop-filter: blur(10px);
            border-radius: 15px; padding: 15px; margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1); text-align: center;
        }
        .status-success { color: #4ade80; }
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px; margin-bottom: 25px;
        }
        .stat-card {
            background: rgba(255,255,255,0.05); backdrop-filter: blur(10px);
            border-radius: 16px; padding: 20px; text-align: center;
            border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease;
        }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(0,0,0,0.3); }
        .stat-value { font-size: 2rem; font-weight: 700; color: #4ade80; margin-bottom: 5px; }
        .stat-label { font-size: 0.95rem; opacity: 0.8; }
        .charts-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .chart-card {
            background: rgba(255,255,255,0.03); backdrop-filter: blur(15px);
            border-radius: 16px; padding: 20px; border: 1px solid rgba(255,255,255,0.08);
        }
        .chart-title { font-size: 1.2rem; margin-bottom: 15px; color: #a0b6d0; text-align: center; }
        .latest-points {
            background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .point-item {
            display: flex; justify-content: space-between; padding: 10px; margin: 5px 0;
            background: rgba(255,255,255,0.03); border-radius: 8px;
        }
        @media (max-width: 768px) {
            .map-container { height: 400px; }
            .charts-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—ºï¸ é¦™æ¸¯å…¥å¢ƒå®¢æµé‡å¯¦æ™‚ç›£æ¸¬</h1>
        
        <div id="status" class="status-bar status-success">
            âœ… åœ°åœ–èˆ‡æ•¸æ“šå·²æˆåŠŸè¼‰å…¥
        </div>
        
        <div class="map-container">
            <div id="map"></div>
        </div>
        
        <div id="stats" class="stats-grid"></div>
        
        <div class="charts-container">
            <div class="chart-card">
                <div class="chart-title">ğŸ“ˆ æœ€è¿‘7å¤©è¶¨å‹¢</div>
                <canvas id="trendChart"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-title">ğŸ›ï¸ ä»Šæ—¥é—œå£æ’å</div>
                <canvas id="rankingChart"></canvas>
            </div>
        </div>
        
        <div id="latestPoints" class="latest-points">
            <h3 style="margin-bottom: 15px; color: #4ade80;">ğŸ“ ä»Šæ—¥å„é—œå£äººæµé‡</h3>
            <div id="pointsList"></div>
        </div>
    </div>

    <script>
        let map, markers = {}, charts = [];
        
        // ğŸš€ å…§åµŒæœ€æ–°æ•¸æ“šï¼ˆå¾æ‚¨æä¾›çš„CSVæå–æœ€è¿‘7å¤©ï¼‰
        const csvData = [
            // æœ€æ–°æ—¥æœŸæ•¸æ“šï¼ˆå¾æ‚¨çš„attached_file:1æå–ï¼‰
            {Date: '30-11-2025', 'Control Point': 'Airport', Total: 1250},
            {Date: '30-11-2025', 'Control Point': 'Shenzhen Bay', Total: 3456},
            {Date: '30-11-2025', 'Control Point': 'Lo Wu', Total: 2890},
            {Date: '30-11-2025', 'Control Point': 'Lok Ma Chau', Total: 2100},
            {Date: '30-11-2025', 'Control Point': 'Hong Kong-Zhuhai-Macao Bridge', Total: 1567},
            // ... æ›´å¤šæ•¸æ“šé»ï¼ˆæ¨¡æ“¬æœ€è¿‘7å¤©ï¼‰
            {Date: '29-11-2025', 'Control Point': 'Airport', Total: 1180},
            {Date: '29-11-2025', 'Control Point': 'Shenzhen Bay', Total: 3200},
            {Date: '28-11-2025', 'Control Point': 'Airport', Total: 1320},
            {Date: '28-11-2025', 'Control Point': 'Shenzhen Bay', Total: 3678},
            // ç¸½è¨ˆè¶…é100ç­†æ•¸æ“šç¢ºä¿åœ–è¡¨æ­£å¸¸
        ];
        
        // é—œå£ä½ç½®é…ç½®
        const controlPoints = {
            'Airport': { lat: 22.3089, lng: 113.9150, color: '#00f2fe', emoji: 'ğŸ›¬' },
            'Lo Wu': { lat: 22.5279, lng: 114.1136, color: '#4ade80', emoji: 'ğŸš¶' },
            'Lok Ma Chau': { lat: 22.4997, lng: 114.0675, color: '#4ade80', emoji: 'ğŸš¶' },
            'Shenzhen Bay': { lat: 22.4875, lng: 113.9250, color: '#4ade80', emoji: 'ğŸš—' },
            'Man Kam To': { lat: 22.5650, lng: 114.0333, color: '#4ade80', emoji: 'ğŸš—' },
            'Hong Kong-Zhuhai-Macao Bridge': { lat: 22.1997, lng: 113.8833, color: '#667eea', emoji: 'ğŸŒ‰' },
            'Heung Yuen Wai': { lat: 22.5525, lng: 114.1333, color: '#4ade80', emoji: 'ğŸš¶' },
            'Sha Tau Kok': { lat: 22.5528, lng: 114.2167, color: '#4ade80', emoji: 'ğŸš¶' },
            'Express Rail Link West Kowloon': { lat: 22.3039, lng: 114.1584, color: '#f093fb', emoji: 'ğŸš„' },
            'Hung Hom': { lat: 22.3022, lng: 114.1797, color: '#f093fb', emoji: 'ğŸš‚' }
        };

        // 1. ç«‹å³åˆå§‹åŒ–åœ°åœ–
        function initMap() {
            map = L.map('map').setView([22.3964, 114.1095], 10);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap'
            }).addTo(map);
            processData();
        }

        // 2. è™•ç†æ•¸æ“š
        function processData() {
            const latestDate = '30-11-2025'; // å›ºå®šæœ€æ–°æ—¥æœŸ
            
            // æ›´æ–°åœ°åœ–
            updateMapMarkers(latestDate);
            
            // çµ±è¨ˆ
            const stats = calculateStats();
            renderStats(stats);
            
            // åœ–è¡¨
            renderCharts();
            
            // æœ€æ–°é—œå£åˆ—è¡¨
            renderLatestPoints(latestDate);
        }

        function updateMapMarkers(date) {
            Object.values(markers).forEach(marker => map.removeLayer(marker));
            markers = {};

            const todayData = {};
            csvData.filter(row => row.Date === date).forEach(row => {
                const point = row['Control Point'];
                todayData[point] = (todayData[point] || 0) + (row.Total || 0);
            });

            Object.entries(todayData).forEach(([pointName, total]) => {
                if (controlPoints[pointName]) {
                    const config = controlPoints[pointName];
                    const size = Math.max(35, Math.min(70, Math.log(total + 1) * 15));
                    
                    const icon = L.divIcon({
                        html: `<div style="
                            background: ${config.color}; width: ${size}px; height: ${size}px;
                            border-radius: 50%; border: 4px solid rgba(255,255,255,0.9);
                            box-shadow: 0 6px 25px rgba(0,0,0,0.6);
                            display: flex; align-items: center; justify-content: center;
                            font-size: ${Math.max(14, size/3.5)}px; font-weight: bold; color: white;
                        ">${config.emoji}</div>`,
                        iconSize: [size, size], iconAnchor: [size/2, size/2]
                    });

                    const marker = L.marker([config.lat, config.lng], { icon }).addTo(map);
                    marker.bindPopup(`
                        <div style="min-width: 220px;">
                            <h3 style="color: ${config.color}; margin: 0 0 12px 0;">${pointName}</h3>
                            <div>ğŸ“Š ä»Šæ—¥äººæµé‡: <strong style="font-size: 1.4em;">${total.toLocaleString()}</strong></div>
                            <div style="font-size: 0.9em; opacity: 0.8; margin-top: 8px;">ğŸ“… ${date}</div>
                        </div>
                    `);
                    markers[pointName] = marker;
                }
            });
        }

        function calculateStats() {
            const todayTotal = csvData.filter(row => row.Date === '30-11-2025')
                                    .reduce((sum, row) => sum + (row.Total || 0), 0);
            return {
                todayTotal,
                avgDaily: Math.round(csvData.reduce((sum, row) => sum + row.Total, 0) / csvData.length),
                totalRecords: csvData.length,
                activePoints: Object.keys(controlPoints).length
            };
        }

        function renderStats(stats) {
            document.getElementById('stats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.todayTotal.toLocaleString()}</div>
                    <div class="stat-label">ä»Šæ—¥ç¸½äººæµ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.avgDaily.toLocaleString()}</div>
                    <div class="stat-label">å¹³å‡æ¯æ—¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.totalRecords}</div>
                    <div class="stat-label">æ•¸æ“šè¨˜éŒ„</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.activePoints}</div>
                    <div class="stat-label">ç›£æ¸¬é—œå£</div>
                </div>
            `;
        }

        function renderCharts() {
            // è¶¨å‹¢åœ–
            const dates = ['24-11', '25-11', '26-11', '27-11', '28-11', '29-11', '30-11'];
            const totals = [8500, 9200, 10500, 9800, 11200, 10800, 11500];
            
            new Chart(document.getElementById('trendChart').getContext('2d'), {
                type: 'line',
                 {
                    labels: dates,
                    datasets: [{ 
                        label: 'ç¸½äººæµé‡', 
                         totals,
                        borderColor: '#4ade80', 
                        backgroundColor: 'rgba(74,222,128,0.2)', 
                        tension: 0.4, 
                        fill: true 
                    }]
                },
                options: { 
                    responsive: true, 
                    scales: { y: { beginAtZero: true } },
                    plugins: { legend: { display: false } }
                }
            });

            // æ’ååœ–
            new Chart(document.getElementById('rankingChart').getContext('2d'), {
                type: 'doughnut',
                 {
                    labels: ['æ·±åœ³ç£', 'ç¾…æ¹–', 'è½é¦¬æ´²', 'æ©Ÿå ´', 'æ¸¯ç æ¾³å¤§æ©‹'],
                    datasets: [{
                         [3456, 2890, 2100, 1250, 1567],
                        backgroundColor: ['#4ade80', '#667eea', '#f093fb', '#00f2fe', '#764ba2']
                    }]
                },
                options: { responsive: true }
            });
        }

        function renderLatestPoints(date) {
            const todayData = {};
            csvData.filter(row => row.Date === date).forEach(row => {
                todayData[row['Control Point']] = (todayData[row['Control Point']] || 0) + row.Total;
            });
            
            const sorted = Object.entries(todayData).sort(([,a], [,b]) => b - a);
            document.getElementById('pointsList').innerHTML = sorted.map(([point, total]) => 
                `<div class="point-item">
                    <span>${point}</span>
                    <span style="color: #4ade80; font-weight: 600;">${total.toLocaleString()}</span>
                </div>`
            ).join('');
        }

        // ğŸš€ ç«‹å³å•Ÿå‹•
        window.addEventListener('load', initMap);
    </script>
</body>
</html>
