name: æ¯æ—¥è‡ªå‹•æ›´æ–°å‡ºå…¥å¢ƒ CSV
on:
  schedule:
    - cron: '0 2 * * *'  # æ¯æ—¥ HKT 10:00
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: å»ºç«‹è³‡æ–™å¤¾ä¸¦ä¸‹è¼‰ CSV
      run: |
        mkdir -p "0Data/Immigration Department/Immd/ControlPoint/data"
        curl -L -o "0Data/Immigration Department/Immd/ControlPoint/data/immigration.csv" \
        "https://www.immd.gov.hk/opendata/eng/transport/immigration_clearance/statistics_on_daily_passenger_traffic.csv"
    
    - name: æª¢æŸ¥æ›´æ–°
      id: diff
      run: |
        git diff --quiet "0Data/Immigration Department/Immd/ControlPoint/data/immigration.csv" || echo "changed=true" >> $GITHUB_OUTPUT
    
    - name: æäº¤æ›´æ–°
      if: steps.diff.outputs.changed == 'true'
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add "0Data/Immigration Department/Immd/ControlPoint/data/immigration.csv"
        git commit -m "ğŸ“Š è‡ªå‹•æ›´æ–° CSV $(date +'%Y-%m-%d')"
        git push
